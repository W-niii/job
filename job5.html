<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>XXç”µå•† Â· è®¢å•å½•å…¥ä¸é”€å”®çœ‹æ¿</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .box { border:1px solid #ddd; padding:15px; margin:15px 0; border-radius: 5px; }
    .clock { font-size: 20px; font-weight: bold; color: #336699; }
    label { display:inline-block; width:120px; font-weight: bold; }
    table { border-collapse: collapse; width:100%; margin-top:10px; }
    th, td { border:1px solid #ccc; padding:8px; text-align:center; }
    th { background-color: #f2f2f2; }
    input, select { padding: 5px; margin: 5px 0; }
    button { padding: 8px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #45a049; }
    .tip-box { padding:12px; background:#eef9ff; border-left:5px solid #3aa0e6; margin:10px 0; font-size:15px; }
    .time-box { padding:12px; margin:10px 0; font-size:15px; }
    .active-time { background:#fffbe6; border-left:5px solid #f4d06f; }
    .normal-time { background:#f5f5f5; border-left:5px solid #ccc; }
    .result-box { background-color: #f9f9f9; padding: 10px; margin-top: 15px; border-radius: 5px; }
  </style>
</head>
<body>

<!-- ===================== é¡¶éƒ¨æ ‡é¢˜ ===================== -->
<script>
  // ä½¿ç”¨document.write()æ–¹æ³•è¾“å‡ºæ ‡é¢˜å’Œæç¤º
  document.write("<h1>XXç”µå•† Â· è¿è¥åå° Â· è®¢å•å½•å…¥ä¸é”€å”®çœ‹æ¿</h1>");
  document.write("<p>æ¬¢è¿ä½¿ç”¨å†…éƒ¨å·¥å…·ï¼Œå®æ—¶æŸ¥çœ‹è®¢å•ä¸é”€å”®æƒ…å†µã€‚</p>");

  // å…¨å±€ä¼˜æƒ  + åŠ ä»·æ¸©é¦¨æç¤º
  document.write(`
  <div class="tip-box">
    <strong>ğŸ’¡ æ¸©é¦¨æç¤ºï¼šæœ¬åº—å½“å‰å¯äº«å—çš„ä¼˜æƒ ä¸åŠ ä»·æ”¿ç­–å¦‚ä¸‹ï¼š</strong>
    <ul style="margin:8px 0 0 20px; line-height:1.6;">
      <li>ğŸ‰ VIP å®¢æˆ·äº«å— <strong>9 æŠ˜ä¼˜æƒ </strong></li>
      <li>âš¡ åŠ æ€¥å‘è´§ä»·æ ¼ä¼š <strong>Ã—1.1</strong></li>
      <li>â° æ¯å°æ—¶å‰ 10 åˆ†é’Ÿå†äº« <strong>8.5 æŠ˜</strong></li>
      <li>ğŸ‘¥ æ™®é€šå®¢æˆ·è´­ä¹°è¶…è¿‡3ä»¶å†äº« <strong>9 æŠ˜</strong></li>
    </ul>
  </div>
  `);

  // å½“å‰åˆ†é’ŸåŠ¨æ€æ´»åŠ¨æç¤º
  var nowForBanner = new Date();
  var minuteForBanner = nowForBanner.getMinutes();

  if (minuteForBanner >= 0 && minuteForBanner <= 9) {
    document.write(`
      <div class="time-box active-time">
        â³ å½“å‰ä¸ºå‰ 10 åˆ†é’Ÿï¼æœ¬å•å¯é¢å¤–äº«å— <strong>8.5 æŠ˜</strong> æ—¶æ®µä¼˜æƒ ï¼
      </div>
    `);
  } else {
    document.write(`
      <div class="time-box normal-time">
        ğŸ•’ å°è´´å£«ï¼šæ¯ä¸ªæ•´ç‚¹å‰ 10 åˆ†é’Ÿäº«å— 8.5 æŠ˜ä¼˜æƒ ï¼Œè¯·ç•™æ„ä¸‹å•æ—¶é—´ï½
      </div>
    `);
  }
</script>

<!-- ===================== æ—¶é’ŸåŒº ===================== -->
<div class="box">
  <h2>å½“å‰ç³»ç»Ÿæ—¶é—´</h2>
  <div id="clock" class="clock"></div>
</div>

<!-- ===================== è®¢å•å½•å…¥ ===================== -->
<div class="box">
  <h2>æ–°å»ºè®¢å•</h2>
  <form onsubmit="return validateForm();">
    <p>
      <label>å®¢æˆ·åç§°ï¼š</label>
      <input type="text" id="customerName" required>
    </p>
    <p>
      <label>å•†å“å•ä»·ï¼ˆÂ¥ï¼‰ï¼š</label>
      <input type="number" id="priceInput" min="0.01" step="0.01" required>
    </p>
    <p>
      <label>æ•°é‡ï¼ˆä»¶ï¼‰ï¼š</label>
      <input type="number" id="qtyInput" min="1" step="1" required>
    </p>
    <p>
      <label>å®¢æˆ·ç±»å‹ï¼š</label>
      <select id="customerType">
        <option value="normal">æ™®é€šå®¢æˆ·</option>
        <option value="vip">VIP å®¢æˆ·</option>
      </select>
    </p>
    <p>
      <label>åŠ æ€¥å‘è´§ï¼š</label>
      <input type="checkbox" id="urgentFlag"> æ˜¯
    </p>
    <p><button type="submit">æ·»åŠ è®¢å•</button></p>
  </form>
  <div id="orderResult" class="result-box"></div>
</div>

<!-- ===================== é”€å”®çœ‹æ¿ ===================== -->
<div class="box">
  <h2>é”€å”®çœ‹æ¿</h2>
  <div id="dashboard"></div>
  <div id="orderTable"></div>
</div>

<script>
  // ================================================================
  //                          æ¨¡æ‹Ÿæ—¶é’ŸåŠŸèƒ½
  // ================================================================
  function padZero(n) {
    return n < 10 ? "0" + n : n;
  }

  function updateClock() {
    var now = new Date();
    var y = now.getFullYear();
    var m = now.getMonth() + 1;
    var d = now.getDate();
    var hh = now.getHours();
    var mm = now.getMinutes();
    var ss = now.getSeconds();

    var weekNames = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];
    var w = weekNames[now.getDay()];

    var timeStr =
      y + "å¹´" + padZero(m) + "æœˆ" + padZero(d) +
      "æ—¥ æ˜ŸæœŸ" + w + " " +
      padZero(hh) + ":" + padZero(mm) + ":" + padZero(ss);

    document.getElementById("clock").innerHTML = timeStr;
  }

  updateClock();
  setInterval(updateClock, 1000);

  // ================================================================
  //                         å…¨å±€è®¢å•æ•°ç»„
  // ================================================================
  var orders = [];

  // ================================================================
  //                         è¡¨å•æ ¡éªŒé€»è¾‘
  // ================================================================
  function validateForm() {
    var nameStr = document.getElementById("customerName").value;
    var priceStr = document.getElementById("priceInput").value;
    var qtyStr = document.getElementById("qtyInput").value;
    var typeStr = document.getElementById("customerType").value;
    var urgentChecked = document.getElementById("urgentFlag").checked;

    var valid = true;

    // å®¢æˆ·åç§°æ ¡éªŒ
    if (nameStr == null || nameStr.trim() === "") {
      alert("å®¢æˆ·åç§°ä¸èƒ½ä¸ºç©ºï¼");
      valid = false;
    }

    // å•†å“å•ä»·æ ¡éªŒ
    var price = parseFloat(priceStr);
    if (isNaN(price) || price <= 0) {
      alert("å•†å“å•ä»·å¿…é¡»æ˜¯å¤§äº 0 çš„æ•°å­—ï¼");
      valid = false;
    }

    // æ•°é‡æ ¡éªŒ
    var qty = parseInt(qtyStr, 10);
    if (isNaN(qty) || qty <= 0) {
      alert("æ•°é‡å¿…é¡»æ˜¯å¤§äº 0 çš„æ•´æ•°ï¼");
      valid = false;
    }

    if (!valid) {
      document.getElementById("orderResult").innerHTML =
        "<p style='color:red;'>è®¢å•å½•å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥ã€‚</p>";
      return false;
    }

    processOrder(nameStr.trim(), price, qty, typeStr === "vip", urgentChecked);
    return false;
  }

  // ================================================================
  //                         è®¢å•ä¸šåŠ¡é€»è¾‘
  // ================================================================
  function processOrder(customerName, price, quantity, isVip, isUrgent) {
    // â‘  æ­£å¸¸æ€»ä»·
    var baseTotal = price * quantity;
    
    // â‘¡ VIPæŠ˜æ‰£
    var afterVip = isVip ? baseTotal * 0.9 : baseTotal;
    
    // â‘¢ åŠ æ€¥è´¹ç”¨
    var afterUrgent = isUrgent ? afterVip * 1.1 : afterVip;
    
    // â‘£ å‰10åˆ†é’ŸæŠ˜æ‰£
    var now = new Date();
    var minute = now.getMinutes();
    var hitTimeDiscount = false;
    var finalTotal = afterUrgent;
    
    if (minute >= 0 && minute <= 9) {
      finalTotal *= 0.85;
      hitTimeDiscount = true;
    }
    
    // â‘¤ æ™®é€šå®¢æˆ·è´­ä¹°è¶…è¿‡3ä»¶çš„æŠ˜æ‰£ï¼ˆä½œä¸šè¦æ±‚æ–°å¢ï¼‰
    var hitQuantityDiscount = false;
    if (!isVip && quantity > 3) {
      finalTotal *= 0.9;
      hitQuantityDiscount = true;
    }
    
    // åˆ¤æ–­æ˜¯å¦ä¸ºå¤§é¢VIPè®¢å•
    var isImportant = isVip && finalTotal > 1000;
    
    // ç”Ÿæˆä¼˜æƒ è¯¦æƒ…
    var tipsHtml = "<ul>";
    tipsHtml += isVip ? "<li>VIP 9æŠ˜å·²åº”ç”¨</li>" : "<li>æ™®é€šå®¢æˆ·æ—  VIP ä¼˜æƒ </li>";
    tipsHtml += isUrgent ? "<li>åŠ æ€¥ Ã—1.1 å·²åº”ç”¨</li>" : "<li>æœªåŠ æ€¥</li>";
    tipsHtml += hitTimeDiscount ? "<li>å‘½ä¸­å‰ååˆ†é’Ÿ Ã—0.85</li>" : "<li>æ— æ—¶æ®µæŠ˜æ‰£</li>";
    tipsHtml += hitQuantityDiscount ? "<li>æ™®é€šå®¢æˆ·è´­ä¹°è¶…è¿‡3ä»¶é¢å¤–9æŠ˜</li>" : "";
    tipsHtml += "</ul>";
    
    // æ˜¾ç¤ºè®¢å•ç»“æœ
    document.getElementById("orderResult").innerHTML =
      "<h3>è®¢å•å½•å…¥æˆåŠŸï¼š</h3>" +
      "<p>å®¢æˆ·åç§°ï¼š" + customerName + "</p>" +
      "<p>åŸºç¡€é‡‘é¢ï¼šÂ¥" + baseTotal.toFixed(2) + "</p>" +
      "<p>VIP åï¼šÂ¥" + afterVip.toFixed(2) + "</p>" +
      "<p>åŠ æ€¥åï¼šÂ¥" + afterUrgent.toFixed(2) + "</p>" +
      "<p>æœ€ç»ˆé‡‘é¢ï¼šÂ¥" + finalTotal.toFixed(2) + "</p>" +
      "<p>è®¢å•ç±»å‹ï¼š" + (isImportant ? "å¤§é¢ VIP" : "æ™®é€šè®¢å•") + "</p>" +
      "<div style='background:#eef; padding:8px; margin-top:10px; border-radius:4px;'>ä¼˜æƒ è¯¦æƒ…ï¼š" + tipsHtml + "</div>";
    
    // å°†è®¢å•ä¿å­˜åˆ°æ•°ç»„
    orders.push({
      name: customerName,
      price: price,
      qty: quantity,
      baseTotal: baseTotal,
      finalTotal: finalTotal,
      isVip: isVip,
      isUrgent: isUrgent,
      hitTimeDiscount: hitTimeDiscount,
      hitQuantityDiscount: hitQuantityDiscount
    });
    
    // æ›´æ–°é”€å”®çœ‹æ¿
    renderDashboard();
  }

  // ================================================================
  //                         é”€å”®çœ‹æ¿
  // ================================================================
  function renderDashboard() {
    var count = orders.length;
    var totalSales = 0;
    
    // è®¡ç®—é”€å”®æ€»é¢
    for (var i = 0; i < orders.length; i++) {
      totalSales += orders[i].finalTotal;
    }
    
    var avg = count > 0 ? totalSales / count : 0;
    
    // æ›´æ–°ç»Ÿè®¡æ•°æ®
    document.getElementById("dashboard").innerHTML =
      "<h3>é”€å”®ç»Ÿè®¡</h3>" +
      "<p>è®¢å•æ•°ï¼š" + count + "</p>" +
      "<p>é”€å”®æ€»é¢ï¼šÂ¥" + totalSales.toFixed(2) + "</p>" +
      "<p>å¹³å‡å®¢å•ä»·ï¼šÂ¥" + avg.toFixed(2) + "</p>";
    
    // ç”Ÿæˆè®¢å•è¡¨æ ¼
    var tableHtml = "<h3>è®¢å•å†å²</h3><table><tr>" +
      "<th>å®¢æˆ·åç§°</th><th>å•ä»·</th><th>æ•°é‡</th><th>åŸºç¡€é‡‘é¢</th><th>æœ€ç»ˆé‡‘é¢</th><th>VIP</th><th>åŠ æ€¥</th><th>å‰ååˆ†é’Ÿ</th><th>æ•°é‡æŠ˜æ‰£</th></tr>";
    
    if (orders.length === 0) {
      tableHtml += "<tr><td colspan='9'>æš‚æ— è®¢å•è®°å½•</td></tr>";
    } else {
      for (var j = 0; j < orders.length; j++) {
        var o = orders[j];
        tableHtml += "<tr>" +
          "<td>" + o.name + "</td>" +
          "<td>Â¥" + o.price.toFixed(2) + "</td>" +
          "<td>" + o.qty + "</td>" +
          "<td>Â¥" + o.baseTotal.toFixed(2) + "</td>" +
          "<td>Â¥" + o.finalTotal.toFixed(2) + "</td>" +
          "<td>" + (o.isVip ? "æ˜¯" : "å¦") + "</td>" +
          "<td>" + (o.isUrgent ? "æ˜¯" : "å¦") + "</td>" +
          "<td>" + (o.hitTimeDiscount ? "æ˜¯" : "å¦") + "</td>" +
          "<td>" + (o.hitQuantityDiscount ? "æ˜¯" : "å¦") + "</td>" +
          "</tr>";
      }
    }
    
    tableHtml += "</table>";
    document.getElementById("orderTable").innerHTML = tableHtml;
  }
  
  // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–çœ‹æ¿
  renderDashboard();
</script>

</body>
</html>